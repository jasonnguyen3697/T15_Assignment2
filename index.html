<!DOCTYPE html>

<html>
  <head>
      <meta charset="utf-8">
      <title>Traffic analyser</title>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <script src="/socket.io/socket.io.js"></script>
      <link rel="stylesheet" href="main.css">
  </head>
    
<script>
var iosocket=io.connect();
    
//GOOGLE FIREBASE INITIALIZATION
var admin = require("firebase-admin");
var serviceAccount = require("./serviceAccountKey.json");

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: "https://fit3140t15p1.firebaseio.com/"  // IMPORTANT: repalce the url with yours
});

var ref= admin.database().ref("/motionSensorData");;
var long=0;
var short=0;
var visitors=0;
var data=[];
var threshold=3;


ref.on("child_added", function(snapshot) {
    var newentry = snapshot.val();
    var newtime=newentry.time;
    data.push(newentry.time);
    
    if (newtime>threshold){
        long+=1;    
    }
    else{
        short+=1;    
    }
    
    if (data.length()>3){
        if (data[data.length()-1]>threshold && data[data.length()-2]<threshold && data[data.length()-3]>threshold && data[data.length()-4]>threshold){
            visitors+=1;                                                                               
        }        
        
    }
    console.log(long);
    console.log(short);
    console.log(visitors);
});
    

function ToggleLed(){
    iosocket.emit('ledchange');
    //$('#IncomingServerMessages').append($('<li></li>').text('LED Toggled');
}
function SensorToggle(){
    iosocket.emit('sensorchange');
    //$('#IncomingServerMessages').append($('<li></li>').text('Sensor Toggled');
}
function ResetDatabase(){
    iosocket.emit('reset');
    //$('#IncomingServerMessages').append($('<li></li>').text('Database Reset');
}        
</script>    
    
        
  <body>
      
      <div id='longMsg'>Number of long messages:</div>
      <div id='shortMsg'>Number of short messages:</div>
      <div id='visitor'>Number of visitors:</div>
      <button type="button" onClick="ToggleLed()">LED Toggle</button>
      <button type="button" onClick="SensorToggle()">Sensor Toggle</button>
      <button type="button" onClick="ResetDatabase()">Clear Database</button>
      <div class=servermessages>Server messages:<ul id="IncomingServerMessages"; ></ul></div>
     

  </body>

</html>
