var admin = require("firebase-admin");

// Fetch the service account key JSON file contents
var serviceAccount = require("./serviceAccountKey.json");

// Initialize the app with a service account, granting admin privileges
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: "https://fit3140t15p1.firebaseio.com"  // IMPORTANT: repalce the url with yours 
});

// As an admin, the app has access to read and write all data, regardless of Security Rules
var db = admin.database();
var ref = db.ref("/motionSensorData"); // channel name
ref.on("value", function(snapshot) {   //this callback will be invoked with each new object
  console.log(snapshot.val());         // How to retrive the new added object
}, function (errorObject) {             // if error
  console.log("The read failed: " + errorObject.code);
});

var another=false;
var on=false;
var idno=1;
var sensormode=false;
function switchoff(){
    if(another)
    {
      setTimeout(switchoff2,500)
    }
    else
    {
    //set LED to off
    }
}
function switchoff2(){
  //set LED to off
}

function reset()
{

}

function sensorstate(){

}
function sensed()
{
  if(sensormode)
  {
    ref.push({
      id:idno,
      type:'motion',
      action:'on',
      time:now()
    });
    if (on==false)
    {
      on=true;
      setTimeout(switchoff,1500)
    }
    else
    {
      another=true;
    }
    idno++;
  }
}
